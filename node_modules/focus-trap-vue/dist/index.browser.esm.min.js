/*!
  * focus-trap-vue v0.0.4
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
/*!
  * focus-trap-vue v0.0.4
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
var e=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],t=e.join(","),n="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function a(e,a){a=a||{};var o,r,s,l=[],d=[],f=e.querySelectorAll(t);for(a.includeContainer&&n.call(e,t)&&(f=Array.prototype.slice.apply(f)).unshift(e),o=0;o<f.length;o++)i(r=f[o])&&(0===(s=c(r))?l.push(r):d.push({documentOrder:o,tabIndex:s,node:r}));return d.sort(u).map((function(e){return e.node})).concat(l)}function i(e){return!(!o(e)||function(e){return function(e){return s(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t=function(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t]}(e.ownerDocument.querySelectorAll('input[type="radio"][name="'+e.name+'"]'));return!t||t===e}(e)}(e)||c(e)<0)}function o(e){return!(e.disabled||function(e){return s(e)&&"hidden"===e.type}(e)||function(e){return null===e.offsetParent||"hidden"===getComputedStyle(e).visibility}(e))}a.isTabbable=function(e){if(!e)throw new Error("No node provided");return!1!==n.call(e,t)&&i(e)},a.isFocusable=function(e){if(!e)throw new Error("No node provided");return!1!==n.call(e,r)&&o(e)};var r=e.concat("iframe").join(",");function c(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?function(e){return"true"===e.contentEditable}(e)?0:e.tabIndex:t}function u(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}function s(e){return"INPUT"===e.tagName}var l,d=a,f=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var a in n)v.call(n,a)&&(e[a]=n[a])}return e},v=Object.prototype.hasOwnProperty;var p,b=(p=[],{activateTrap:function(e){if(p.length>0){var t=p[p.length-1];t!==e&&t.pause()}var n=p.indexOf(e);-1===n?p.push(e):(p.splice(n,1),p.push(e))},deactivateTrap:function(e){var t=p.indexOf(e);-1!==t&&p.splice(t,1),p.length>0&&p[p.length-1].unpause()}});function m(e){return setTimeout(e,0)}var h=function(e,t){var n=document,a="string"==typeof e?n.querySelector(e):e,i=f({returnFocusOnDeactivate:!0,escapeDeactivates:!0},t),o={firstTabbableNode:null,lastTabbableNode:null,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},r={activate:function(e){if(o.active)return;F(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=n.activeElement;var t=e&&e.onActivate?e.onActivate:i.onActivate;t&&t();return u(),r},deactivate:c,pause:function(){if(o.paused||!o.active)return;o.paused=!0,s()},unpause:function(){if(!o.paused||!o.active)return;o.paused=!1,F(),u()}};return r;function c(e){if(o.active){clearTimeout(l),s(),o.active=!1,o.paused=!1,b.deactivateTrap(r);var t=e&&void 0!==e.onDeactivate?e.onDeactivate:i.onDeactivate;return t&&t(),(e&&void 0!==e.returnFocus?e.returnFocus:i.returnFocusOnDeactivate)&&m((function(){E(o.nodeFocusedBeforeActivation)})),r}}function u(){if(o.active)return b.activateTrap(r),l=m((function(){E(p())})),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",h,{capture:!0,passive:!1}),n.addEventListener("touchstart",h,{capture:!0,passive:!1}),n.addEventListener("click",g,{capture:!0,passive:!1}),n.addEventListener("keydown",w,{capture:!0,passive:!1}),r}function s(){if(o.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",h,!0),n.removeEventListener("touchstart",h,!0),n.removeEventListener("click",g,!0),n.removeEventListener("keydown",w,!0),r}function v(e){var t=i[e],a=t;if(!t)return null;if("string"==typeof t&&!(a=n.querySelector(t)))throw new Error("`"+e+"` refers to no known node");if("function"==typeof t&&!(a=t()))throw new Error("`"+e+"` did not return a node");return a}function p(){var e;if(!(e=null!==v("initialFocus")?v("initialFocus"):a.contains(n.activeElement)?n.activeElement:o.firstTabbableNode||v("fallbackFocus")))throw new Error("You can't have a focus-trap without at least one focusable element");return e}function h(e){a.contains(e.target)||(i.clickOutsideDeactivates?c({returnFocus:!d.isFocusable(e.target)}):i.allowOutsideClick&&i.allowOutsideClick(e)||e.preventDefault())}function y(e){a.contains(e.target)||e.target instanceof Document||(e.stopImmediatePropagation(),E(o.mostRecentlyFocusedNode||p()))}function w(e){if(!1!==i.escapeDeactivates&&function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e))return e.preventDefault(),void c();(function(e){return"Tab"===e.key||9===e.keyCode})(e)&&function(e){if(F(),e.shiftKey&&e.target===o.firstTabbableNode)return e.preventDefault(),void E(o.lastTabbableNode);if(!e.shiftKey&&e.target===o.lastTabbableNode)e.preventDefault(),E(o.firstTabbableNode)}(e)}function g(e){i.clickOutsideDeactivates||a.contains(e.target)||i.allowOutsideClick&&i.allowOutsideClick(e)||(e.preventDefault(),e.stopImmediatePropagation())}function F(){var e=d(a);o.firstTabbableNode=e[0]||p(),o.lastTabbableNode=e[e.length-1]||p()}function E(e){e!==n.activeElement&&(e&&e.focus?(e.focus(),o.mostRecentlyFocusedNode=e,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(e)&&e.select()):E(p()))}},y={props:{active:{type:Boolean,default:!0},escapeDeactivates:{type:Boolean,default:!0},returnFocusOnDeactivate:{type:Boolean,default:!0},allowOutsideClick:{type:Boolean,default:!0},initialFocus:[String,Function],fallbackFocus:[String,Function]},model:{event:"update:active",prop:"active"},mounted:function(){var e=this;this.$watch("active",(function(t){t?(e.trap=h(e.$el,{escapeDeactivates:e.escapeDeactivates,allowOutsideClick:function(){return e.allowOutsideClick},returnFocusOnDeactivate:e.returnFocusOnDeactivate,onActivate:function(){e.$emit("update:active",!0),e.$emit("activate")},onDeactivate:function(){e.$emit("update:active",!1),e.$emit("deactivate")},initialFocus:e.initialFocus||function(){return e.$el},fallbackFocus:e.fallbackFocus}),e.trap.activate()):e.trap&&e.trap.deactivate()}),{immediate:!0})},beforeDestroy:function(){this.trap&&this.trap.deactivate(),this.trap=null},methods:{activate:function(){this.trap.activate()},deactivate:function(){this.trap.deactivate()}},render:function(){var e=this.$slots.default;if(!e||!e.length||e.length>1)throw new Error("FocusTrap requires exactly one child");return e[0]}};export{y as FocusTrap};
